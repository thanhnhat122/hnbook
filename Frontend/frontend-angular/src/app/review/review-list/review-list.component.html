<div class="container">
  <h2 class="text-center"> Danh sách đánh giá từ khách hàng </h2>

  <table class = "table table-striped table-hover">
    <thead>
        <tr>
          <th> Id sách </th>
          <th> Khách hàng </th>
          <th> Bình luận </th>
          <th> Điểm đánh giá </th>
          <th> Chức năng </th>
        </tr>
    </thead>

    <tbody>
      <tr *ngFor="let review of reviews">
        <td> {{review.bookId}} </td>
        <td> {{review.user.lastName}} {{review.user.firstName}} </td>
        <td class="text-truncate" style="max-width: 200px;"> {{review.comment}} </td>
        <td>
          <div class="rating" *ngIf="review.rate == 5; else rating4">
            <i class="fa-solid fa-star star"></i>
            <i class="fa-solid fa-star star"></i>
            <i class="fa-solid fa-star star"></i>
            <i class="fa-solid fa-star star"></i>
            <i class="fa-solid fa-star star"></i>
          </div>  
          
          <ng-template #rating4>
            <div class="rating" *ngIf="review.rate == 4; else rating3">
              <i class="fa-solid fa-star star"></i>
              <i class="fa-solid fa-star star"></i>
              <i class="fa-solid fa-star star"></i>
              <i class="fa-solid fa-star star"></i>
              <i class="fa-regular fa-star star"></i>
            </div>
          </ng-template>

          <ng-template #rating3>
            <div class="rating" *ngIf="review.rate == 3; else rating2">
              <i class="fa-solid fa-star star"></i>
              <i class="fa-solid fa-star star"></i>
              <i class="fa-solid fa-star star"></i>
              <i class="fa-regular fa-star star"></i>
              <i class="fa-regular fa-star star"></i>
            </div>  
          </ng-template>

          <ng-template #rating2>
            <div class="rating" *ngIf="review.rate == 2; else rating1">
              <i class="fa-solid fa-star star"></i>
              <i class="fa-solid fa-star star"></i>
              <i class="fa-regular fa-star star"></i>
              <i class="fa-regular fa-star star"></i>
              <i class="fa-regular fa-star star"></i>
            </div>  
          </ng-template>

          <ng-template #rating1>
            <div class="rating">
              <i class="fa-solid fa-star star"></i>
              <i class="fa-regular fa-star star"></i>
              <i class="fa-regular fa-star star"></i>
              <i class="fa-regular fa-star star"></i>
              <i class="fa-regular fa-star star"></i>
            </div>  
          </ng-template>
        </td>
        <td>
          <button (click)="reviewDetails(review.id)" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#rateModal"> Chi tiết </button>
          <button (click)="deleteReview(review.id)" class="btn btn-danger" style="margin-left: 10px;"> Xóa </button>
        </td>
    </tr>
    </tbody>
  </table>

  <div class="modal fade" id="rateModal" tabindex="-1" aria-labelledby="rateModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="rateModalLabel"> Chi tiết đánh giá từ khách hàng </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="row">
                <div class="col-5">
                  <div class="text-secondary"> Khách hàng: </div>
                  <div class="text-secondary"> Email: </div>
                  <div class="text-secondary"> Số điện thoại: </div>
                  <div class="text-secondary"> Mã sách được đánh giá: </div>
                </div>

                <div class="col-7">
                  <div> {{reviewTemp.user.lastName}} {{reviewTemp.user.firstName}}  </div>
                  <div> {{reviewTemp.userEmail}} </div>
                  <div> {{reviewTemp.user.phone}} </div>
                  <div> {{reviewTemp.bookId}} </div>
                </div>
              </div>

              <div class="row mt-4">
                <div class="d-flex justify-content-center">
                  <div class="rating d-flex justify-content-center" *ngIf="reviewTemp.rate == 5; else ratingTemp4">
                    <i class="fa-solid fa-star big-star"></i>
                    <i class="fa-solid fa-star big-star"></i>
                    <i class="fa-solid fa-star big-star"></i>
                    <i class="fa-solid fa-star big-star"></i>
                    <i class="fa-solid fa-star big-star"></i>
                  </div>  
                  
                  <ng-template #ratingTemp4>
                    <div class="rating" *ngIf="reviewTemp.rate == 4; else ratingTemp3">
                      <i class="fa-solid fa-star big-star"></i>
                      <i class="fa-solid fa-star big-star"></i>
                      <i class="fa-solid fa-star big-star"></i>
                      <i class="fa-solid fa-star big-star"></i>
                      <i class="fa-regular fa-star big-star"></i>
                    </div>
                  </ng-template>
        
                  <ng-template #ratingTemp3>
                    <div class="rating" *ngIf="reviewTemp.rate == 3; else ratingTemp2">
                      <i class="fa-solid fa-star big-star"></i>
                      <i class="fa-solid fa-star big-star"></i>
                      <i class="fa-solid fa-star big-star"></i>
                      <i class="fa-regular fa-star big-star"></i>
                      <i class="fa-regular fa-star big-star"></i>
                    </div>  
                  </ng-template>
        
                  <ng-template #ratingTemp2>
                    <div class="rating" *ngIf="reviewTemp.rate == 2; else ratingTemp1">
                      <i class="fa-solid fa-star big-star"></i>
                      <i class="fa-solid fa-star big-star"></i>
                      <i class="fa-regular fa-star big-star"></i>
                      <i class="fa-regular fa-star big-star"></i>
                      <i class="fa-regular fa-star big-star"></i>
                    </div>  
                  </ng-template>
        
                  <ng-template #ratingTemp1>
                    <div class="rating">
                      <i class="fa-solid fa-star big-star"></i>
                      <i class="fa-regular fa-star big-star"></i>
                      <i class="fa-regular fa-star big-star"></i>
                      <i class="fa-regular fa-star big-star"></i>
                      <i class="fa-regular fa-star big-star"></i>
                    </div>  
                  </ng-template>
                </div>
              </div>

              <div class="row mt-3">
                <div class="text-secondary"> Đánh giá từ khách: </div>
                <div> {{reviewTemp.comment}} </div>
              </div>
            
              <div class="row mt-4 mb-2">
                <div class="text-secondary"> Viết phản hồi: </div>
                <textarea class="form-control mt-1" rows="5" [(ngModel)]="reviewTemp.response" name="description" id="description" placeholder="Nhập phản hồi đánh giá của khách đối với sản phẩm"></textarea>
              </div>
            </div>
            <div class="modal-footer justify-content-center">
                <button (click)="sendResponse()" type="button" class="btn btn-primary col-5 me-5" data-bs-dismiss="modal"> Phản hồi đánh giá </button>
                <button type="button" class="btn btn-secondary col-3" data-bs-dismiss="modal"> Đóng </button>
            </div>
        </div>
    </div>
</div>
</div>
